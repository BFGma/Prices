CREATE TABLE IF NOT EXISTS Mat_gr (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) NOT NULL UNIQUE
)

CREATE TABLE IF EXISTS Vendor (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) NOT NULL UNIQUE,
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Mat (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_gr integer DEFAULT 0 REFERENCES Mat_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Code_producer integer DEFAULT 0 REFERENCES Vendor(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Code_vendor integer DEFAULT 0 REFERENCES Vendor(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Producer_code integer,
	Vendor_code integer,
	Name varchar(100) NOT NULL UNIQUE,
	Price numeric(12, 2) DEFAULT 0 CHECK (price >= 0),
	Meas varchar(5) NOT NULL DEFAULT 'шт',
	Upddate date NOT NULL DEFAULT CURRENT_DATE
)

CREATE TABLE IF NOT EXISTS Prod_gr (
	Code integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) UNIQUE
)

CREATE TABLE IF NOT EXISTS Prod_box (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_gr integer DEFAULT 0 REFERENCES Prod_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Name varchar(32) NOT NULL UNIQUE,
	Size varchar(20),
	Price numeric(12, 2) DEFAULT 0 CHECK (price >= 0),
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Prod_box_Prod_box (
	Prod_box integer NOT NULL PRIMARY KEY REFERENCES Prod_box(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Prod_box_part integer NOT NULL PRIMARY KEY REFERENCES Prod_box(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Num integer NOT NULL DEFAULT 1
)

CREATE TABLE IF NOT EXISTS Prod_detail (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_mat integer REFERENCES Mat(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Name varchar(32) NOT NULL,
	Weight numeric(7, 2) DEFAULT 0,
	S_primer numeric(7, 2) DEFAULT 0,
	S_enamel numeric(7, 2) DEFAULT 0,
	S_powderpaint numeric(7, 2) DEFAULT 0,
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Prod_gr_Prod_detail (
	Code_gr integer NOT NULL PRIMARY KEY REFERENCES Prod_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Code_detail integer NOT NULL PRIMARY KEY REFERENCES Prod_detail(Code) ON UPDATE CASCADE ON DELETE CASCADE
)

CREATE TABLE IF NOT EXISTS Mat_Prod_box (
	Code_prod_box integer NOT NULL PRIMARY KEY REFERENCES Prod_box(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Code_mat integer NOT NULL PRIMARY KEY REFERENCES Mat(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Num integer NOT NULL DEFAULT 1
)

CREATE TABLE IF NOT EXISTS Scheme (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_gr integer DEFAULT 0 REFERENCES Prod_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Name varchar(64) NOT NULL UNIQUE,
	Price numeric(12, 2) DEFAULT 0 CHECK (Price >= 0)
	Coeff integer NOT NULL DEFAULT 2,
	Inlist boolean DEFAULT TRUE,
	Notes varchar(128)
)

CREATE TABLE IF NOT EXISTS Tool_gr (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) NOT NULL UNIQUE,
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Tool (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_gr integer REFERENCES Tool_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Form varchar(10) NOT NULL DEFAULT 'Notype',
	Form_name varchar(32),
	Size varchar(20),
	Size_diff numeric(3, 2),
	Type varchar(1),
	Num integer DEFAULT 0
)

CREATE TABLE IF NOT EXISTS User_gr (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) NOT NULL UNIQUE
)

CREATE TABLE IF NOT EXISTS User (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Code_gr integer REFERENCES User_gr(Code) ON UPDATE CASCADE ON DELETE SET NULL,
	Login varchar(16) NOT NULL UNIQUE,
	FIO varchar(64) NOT NULL,
	Phone integer(11) NOT NULL,
	Mail varchar(64) NOT NULL UNIQUE,
	Superuser boolean DEFAULT 0
)

CREATE TABLE IF NOT EXISTS Operation (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(64) NOT NULL UNIQUE,
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Workplace (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(64) NOT NULL UNIQUE,
	Note varchar(64)
)

CREATE TABLE IF NOT EXISTS Operation_route (
	Code integer NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	Name varchar(32) NOT NULL UNIQUE,
	Note varchar(128)
)

CREATE TABLE IF NOT EXISTS Operation_route_Operation (
	Code_route integer NOT NULL PRIMARY KEY REFERENCES Operation_route(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Code_operation integer NOT NULL PRIMARY KEY REFERENCES Operation(Code) ON UPDATE CASCADE ON DELETE CASCADE,
	Code_workplace integer PRIMARY KEY REFERENCES Workplace(Code) ON UPDATE CASCADE ON DELETE SET NULL
)

CREATE TABLE IF NOT EXISTS Setts (
	Sett varchar(32) NOT NULL PRIMARY KEY,
	Value varchar(32),
	List varchar(64),
	Note varchar(64)
)

INSERT INTO Mat_gr(Name) VALUES ('Материалы'), ('Автоматы')

INSERT INTO Vendor(Name) VALUES ('IEK'), ('ETM')

INSERT INTO Mat(Code_gr,Code_producer, Code_vendor, Producer_code, Vendor_code, Name, Price, Meas)
VALUES (2, 1, 2, 112233, 332211, 'ВА47-29 1р С 16-25А', 163.99, 'шт')

INSERT INTO Prod_gr(Name) VALUES ('ВРУ 1'), ('ВРУ 3')

